# リファクタリングのための開発フロー

このスキルは、Gilded Roseプロジェクトにおいて、要件定義書（Gherkin仕様書）に基づいてテスト駆動でリファクタリングを進める方法を示します。

## 基本方針

- **対象範囲**: 全アイテムタイプを俯瞰して設計する
- **インプット**: Gherkin仕様書（docs/specifications/gilded-rose.feature） + 分析資料（docs/analysis/） + 既存コード
- **アウトプット**: テストコード + リファクタリングされたコード + レビュー資料
- **アプローチ**: テスト駆動リファクタリング（Red → Green → Refactor）
- **設計思想**: 複数種類のアイテムを統一的に扱える設計を目指す

## 成果物ディレクトリ構造

```
Java/
├── src/
│   ├── main/java/com/gildedrose/
│   │   ├── GildedRose.java           # リファクタリング対象
│   │   ├── Item.java                 # 変更禁止
│   │   └── (リファクタリング後の新クラス群)
│   └── test/java/com/gildedrose/
│       ├── GildedRoseTest.java       # 既存テスト
│       └── (アイテムタイプ別テスト)

docs/
└── refactoring/                      # リファクタリング過程の記録
    ├── domain-analysis/              # フェーズ1の成果物（アイテム毎）
    │   ├── normal-item.md
    │   ├── aged-brie.md
    │   └── ...
    ├── class-design.md               # フェーズ2の成果物（全アイテム統合版）
    ├── test-plans/                   # フェーズ3の成果物
    ├── implementation-tasks.md       # フェーズ4の成果物（実装タスク管理）
    └── reviews/                      # フェーズ5の成果物
```

## フェーズ1: 全アイテムのドメイン概念の抽出

**詳細**: `agents/domain-analysis.md` を参照

**目的**: 各アイテムタイプの振る舞いを分析し、ドメイン概念を抽出する（全アイテムタイプについて順次実施）

## フェーズ2: アイテム全体を踏まえたクラス構造設計

**詳細**: `agents/class-design.md` を参照

**目的**: フェーズ1で抽出した全アイテムの概念を統合し、全体として一貫性のある設計を作る

## フェーズ3: テスト実装

**詳細**: `agents/test-implementation.md` を参照

**目的**: Gherkin仕様書に基づいてJUnitテストを実装する

## フェーズ4: リファクタリング実行

**詳細**: `agents/refactoring.md` を参照

**目的**: テストをパスするように、小さなステップでリファクタリングする

## フェーズ5: レビュー

**詳細**: `agents/review.md` を参照（※未実装）

**目的**: リファクタリング結果を評価し、改善点を記録する

## 制約事項

- **Item.javaは絶対に変更してはいけない**（ゴブリンの制約）
- 各ステップでは必ずテストを実行し、動作を確認する
- リファクタリングは小さなステップで行う（一度に大きく変更しない）
- 既存の動作を変更してはいけない（テストがパスし続けること）
