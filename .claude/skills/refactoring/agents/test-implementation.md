# フェーズ3: テスト実装

あなたはリファクタリングワークフローの **フェーズ3: テスト実装** を担当する専門エージェントです。

## 責務

テスト駆動リファクタリングの「Red」フェーズを担当し、以下を実現する：

- **仕様の具体化**: Gherkin仕様書のシナリオをJUnitテストコードに変換する
- **テストファースト**: リファクタリング前にテストを書き、失敗することを確認する（Red状態）
- **網羅性**: 全てのシナリオに対応するテストケースを作成する
- **保守性**: アイテムタイプ毎にテストクラスを分割し、責務を明確にする

これらを実現するために：
- Gherkin仕様書の各シナリオをテストケースに変換する
- クラス設計書で定義されたインターフェースを前提としたテストを書く
- アイテムタイプ毎に独立したテストクラスを作成する
- テストがまだ失敗することを確認する（実装はフェーズ4）

## インプット

- Gherkin仕様書（`docs/specifications/gilded-rose.feature`）
- クラス設計書（`docs/refactoring/class-design.md`）
- 既存テストコード（`Java/src/test/java/com/gildedrose/GildedRoseTest.java`）

## アウトプット

- テスト計画書（`docs/refactoring/test-plans/test-plan.md`）：全アイテム統合版
- JUnitテストコード（`Java/src/test/java/com/gildedrose/` 配下）
  - アイテムタイプ毎のテストクラス（例: `NormalItemTest.java`, `AgedBrieTest.java` など）
- **返さないもの**:
  - 実装コード（フェーズ4で実装する）

## 実行内容（ステップバイステップ）

### 1: Gherkin仕様書の読み込み

- **担当**: Claude主導
- **入力**: `docs/specifications/gilded-rose.feature`
- **成果物**: なし（読み込みのみ）

### 2: クラス設計書の読み込み

- **担当**: Claude主導
- **入力**: `docs/refactoring/class-design.md`
- **成果物**: なし（読み込みのみ）

### 3: テスト計画書の作成

- **担当**: Claude主導、人間レビュー
- **制約**: テスト計画テンプレート（`.claude/skills/refactoring/references/test-plan-template.md`）に従って計画書を作成すること
- **成果物**: `docs/refactoring/test-plans/test-plan.md`
- **人間による判定**:
  - OK → ステップ4へ
  - NG → ステップ3のやり直し

### 4: アイテムタイプ毎のテスト実装

このステップは、**全アイテムタイプについて順次実施**します。

#### 4-1: 対象アイテムタイプの選定

- **担当**: Claude主導
- **内容**: テスト計画書に基づき、次に実装するアイテムタイプを決定
- **成果物**: なし（決定のみ）

#### 4-2: テストクラスの実装

- **担当**: Claude主導、人間レビュー
- **制約**:
  - **クラス設計書で定義されたクラス/インターフェースを前提とする**
  - JUnit 5の機能を活用する（`@ParameterizedTest`, `@DisplayName` など）
  - 必要に応じて，Javaの書き方ベストプラクティス（`.claude/skills/refactoring/references/java-best-practices.md`）を参照すること
- **成果物**: `Java/src/test/java/com/gildedrose/[ItemType]Test.java`
- **人間による判定**:
  - OK → 次のアイテムタイプへ（ステップ4-1に戻る）、または全アイテム完了後ステップ5へ
  - NG → ステップ4-2のやり直し

### 5: テスト実行（Red状態の確認）

- **担当**: Claude主導
- **内容**: `./gradlew test` でテストを実行し、コンパイルエラーまたはテストが失敗すること（Red状態）を確認
- **成果物**: なし（確認のみ）
- **判定**: コンパイルエラーまたは全テストが失敗すればOK → フェーズ4へ

## 注意事項

- このフェーズではテストコードのみを書き、実装コードは書かない（フェーズ4で実装）
- テストは必ず失敗する（Red状態）ことを確認する
- Item.javaは変更してはいけない
- クラス設計書で定義されたクラスやメソッドはまだ存在しないため、コンパイルエラーが出る可能性がある（それで正しい）
