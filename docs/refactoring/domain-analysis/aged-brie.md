# Aged Brie のドメイン分析

## 1. 振る舞いの整理

### 1.1 主要な振る舞い

- **振る舞い1: 販売期限の減少**
  - Gherkin仕様書: すべてのシナリオで、1日経過すると販売期限が1減少する
  - 分析資料: sellInは毎日-1される（期限まで残り日数を表す）

- **振る舞い2: 品質の向上（期限内）**
  - Gherkin仕様書: 「販売期限内では毎日品質が1ずつ向上する」（Scenario: 販売期限内で次の日に品質が1向上している）
  - 分析資料: sellIn > 0 のとき、quality +1（quality < 50の場合）

- **振る舞い3: 品質の加速向上（期限切れ）**
  - Gherkin仕様書: 「販売期限切れでは毎日品質が2ずつ向上する」（Scenario: 販売期限当日/切れで次の日に品質が2向上している）
  - 分析資料: sellIn <= 0 のとき、quality +2（ただし、quality = 49 の場合は +1 のみ）

- **振る舞い4: 品質の上限制約**
  - Gherkin仕様書: 「Sulfuras以外のアイテムは品質値が50を超えない」（共通ルール）
  - 分析資料: quality は 50 を超えない

### 1.2 振る舞いのパターン

- **sellInの変化パターン**:
  - 毎日必ず-1される
  - 値の下限はない（負の値も取り得る）
  - **通常アイテムと同じパターン**

- **qualityの変化パターン**:
  - **sellIn > 0**（期限内）: quality +1
  - **sellIn <= 0**（期限切れ）: quality +2
  - **境界条件**: quality = 49 かつ sellIn <= 0 の場合、quality +1 のみ（+2にならない）

- **特殊ルール**:
  - quality は 0 以上 50 以下
  - sellIn = 0 の日は「期限当日」だが、実装上は「期限切れ扱い」（quality +2が適用される）
  - **通常アイテムとの対称性**: 通常アイテムが劣化（-1/-2）するのに対し、Aged Brieは向上（+1/+2）する

## 2. ドメイン概念の抽出

### 2.1 このアイテムの特徴

- **特徴1: 時間経過による熟成（Aging/Appreciation over time）**
  - **説明**: Aged Brieは時間が経つにつれて品質が向上する（チーズの熟成を表現）
  - **具体例**:
    - Gherkin仕様書: 品質が10のAged Brieが販売期限まであと3日の場合、1日経過すると品質は11になる
    - 分析資料: デシジョンテーブル#1（sellIn > 0, quality <= 48 → quality +1）

- **特徴2: 期限切れによる加速熟成（Accelerated appreciation after expiry）**
  - **説明**: 販売期限を過ぎると、品質の向上速度が2倍になる
  - **具体例**:
    - Gherkin仕様書: 品質が10のAged Brieが販売期限当日の場合、1日経過すると品質は12になる
    - 分析資料: デシジョンテーブル#4（sellIn <= 0, quality <= 48 → quality +2）

- **特徴3: 品質上限（Quality ceiling）**
  - **説明**: 品質は50を超えない
  - **具体例**:
    - Gherkin仕様書: 品質が50のAged Brieは、期限内でも期限切れでも、次の日になっても品質は50のままである
    - 分析資料: デシジョンテーブル#3, #6（quality = 50 → quality変化なし）

- **特徴4: 境界条件での特殊な振る舞い（Boundary behavior）**
  - **説明**: quality = 49 で期限切れの場合、+2ではなく+1のみ増加する
  - **具体例**:
    - Gherkin仕様書: 品質が49のAged Brieが販売期限当日の場合、1日経過すると品質は50になる（51にはならない）
    - 分析資料: デシジョンテーブル#5（sellIn <= 0, quality = 49 → quality +1）、境界値分析3.2

## 3. 他のアイテムタイプとの比較（メモ）

### 他のアイテムとの共通点
- sellInの減少ルール（毎日-1）は、Sulfuras以外の全アイテムに共通する
- 品質の上限/下限制約も、共通ルールとして扱われる
- 期限内と期限切れで振る舞いが変わる点は、通常アイテムと同じパターン

### 他のアイテムとの相違点
- **Aged Brieの特徴**: 時間経過で品質が「向上」する（+1/+2）
- **通常アイテムとの対称性**:
  - 通常アイテム: 劣化（-1/-2）、下限0
  - Aged Brie: 向上（+1/+2）、上限50
  - 期限切れで変化速度が2倍になる点は共通
- **予想される他のアイテムの特徴**:
  - Sulfurasは伝説のアイテムで、sellInもqualityも変化しない可能性がある
  - Backstage passesは期限との関係で複雑な振る舞いをする可能性がある

※このセクションの内容は、フェーズ2のクラス設計で活用されます。
