# Sulfuras のドメイン分析

## 1. 振る舞いの整理

### 1.1 主要な振る舞い

- **振る舞い1: 品質の不変性**
  - Gherkin仕様書: 「伝説のアイテムであり、品質が80で一定である」（Rule）、「次の日になっても品質が80のままである」（Scenario）
  - 分析資料: quality は常に80で変化しない

- **振る舞い2: 販売期限の不変性**
  - Gherkin仕様書: sellInについての明示的な記載はないが、他のアイテムとは異なり変化しないことが示唆される
  - 分析資料: sellInは常に初期値のまま、変化しない

- **振る舞い3: 共通ルールからの除外**
  - 分析資料: 「毎日の終わりには、両方の項目の値を1小さくします」というルールの例外
  - 分析資料: 「Quality値は50以上にはなりません」というルールの例外（品質80を許容）

### 1.2 振る舞いのパターン

- **sellInの変化パターン**:
  - 変化なし（常に初期値のまま）
  - **他のアイテムとは完全に異なるパターン**

- **qualityの変化パターン**:
  - 変化なし（常に80）
  - sellInの値に関わらず、品質は常に一定
  - **他のアイテムとは完全に異なるパターン**

- **特殊ルール**:
  - 品質は常に80（他のアイテムの上限50を超える）
  - 販売期限の概念が適用されない（sellInの値が何であれ、振る舞いは変わらない）

## 2. ドメイン概念の抽出

### 2.1 このアイテムの特徴

- **特徴1: 完全な不変性（Complete immutability）**
  - **説明**: Sulfurasは時間経過の影響を受けず、sellInもqualityも変化しない
  - **具体例**:
    - Gherkin仕様書: 品質が80の「Sulfuras, Hand of Ragnaros」が存在する場合、1日経過しても品質は80のままである
    - 分析資料: デシジョンテーブル#1（アイテム名="Sulfuras, Hand of Ragnaros" → sellIn変化0, quality変化0）

- **特徴2: 伝説のアイテムとしての特別扱い（Legendary item exception）**
  - **説明**: 伝説のアイテムとして、通常の品質上限（50）を超える品質（80）を持つ
  - **具体例**:
    - Gherkin仕様書: 「Sulfurasは伝説のアイテムであり、品質が80で一定である」
    - 分析資料: 品質80を許容（共通ルールの例外）

- **特徴3: 販売期限の概念が不適用（No expiry concept）**
  - **説明**: 販売期限の影響を受けない（sellInの値に関わらず、振る舞いは常に同じ）
  - **具体例**:
    - 分析資料: 境界値分析3.1（sellIn > 0, sellIn = 0, sellIn < 0 のいずれも変化なし）

- **特徴4: 名前による判定（Name-based identification）**
  - **説明**: アイテム名「Sulfuras, Hand of Ragnaros」で特定される
  - **具体例**:
    - 分析資料: デシジョンテーブル（アイテム名は完全一致で判定される）
    - 分析資料: 実装における除外処理（`items[i].name.equals("Sulfuras, Hand of Ragnaros")`）

## 3. 他のアイテムタイプとの比較（メモ）

### 他のアイテムとの共通点
- 同じ在庫管理システム内で扱われる
- Itemクラスのインスタンスとして表現される（name, sellIn, qualityを持つ）

### 他のアイテムとの相違点
- **Sulfurasの完全な特異性**:
  - 通常アイテム: 劣化（-1/-2）、下限0、sellIn減少
  - Aged Brie: 向上（+1/+2）、上限50、sellIn減少
  - Sulfuras: **不変（0）**、品質80固定、sellIn不変
- **共通ルールからの除外**:
  - 他のアイテムはすべて sellIn が毎日-1されるが、Sulfurasは除外される
  - 他のアイテムは品質の上限が50だが、Sulfurasは80を許容する
- **実装上の扱い**:
  - 他のアイテムは品質更新ロジックが適用されるが、Sulfurasは複数箇所で除外処理がされている
  - `if (!items[i].name.equals("Sulfuras, Hand of Ragnaros"))` という条件分岐で除外される

### フェーズ2への示唆
- Sulfurasは他のアイテムと根本的に異なるため、設計上は特別な扱いが必要
- 可能性1: Sulfurasを特別なサブタイプとして扱う（Null Objectパターンなど）
- 可能性2: 不変アイテムとして汎用的に扱える設計を検討する

※このセクションの内容は、フェーズ2のクラス設計で活用されます。
