# language: ja
Feature: Gilded Rose在庫品質管理システム

  Gilded Rose旅館は、上質な商品を販売する小さな宿です。
  商品の品質（quality）と販売期限（sellIn）は日々変化します。
  このシステムは、毎日の終わりに在庫品質を自動更新します。

  Background:
    Given 在庫管理システムが初期化されている

  # ========================================
  # 通常アイテム (Normal Item)
  # ========================================

  Rule: 通常アイテムは販売期限内では毎日品質が1ずつ劣化する

    Scenario: 販売期限内で次の日に品質が1劣化している
      Given 品質が1の通常アイテムが存在する
      And そのアイテムの販売期限まであと3日である
      When 1日経過する
      Then そのアイテムの品質は0である
      And そのアイテムの販売期限まであと2日である

  Rule: 通常アイテムは販売期限が過ぎると品質が2倍速で劣化する

    Scenario: 販売期限当日で次の日に品質が2劣化している
      Given 品質が10の通常アイテムが存在する
      And そのアイテムは販売期限当日である（期限切れ劣化が適用される）
      When 1日経過する
      Then そのアイテムの品質は8である
      And そのアイテムは販売期限を1日過ぎている

    Scenario: 販売期限切れで次の日に品質が2劣化している
      Given 品質が10の通常アイテムが存在する
      And そのアイテムは販売期限を1日過ぎている
      When 1日経過する
      Then そのアイテムの品質は8である
      And そのアイテムは販売期限を2日過ぎている

  # ========================================
  # 共通ルール
  # ========================================

  Rule: すべてのアイテムは品質値が0未満にならない

    Scenario: 通常アイテムについて，販売期限内で品質が0の場合、次の日になっても品質は0のままである
      Given 品質が0の通常アイテムが存在する
      And そのアイテムの販売期限まであと3日である
      When 1日経過する
      Then そのアイテムの品質は0である
      And そのアイテムの販売期限まであと2日である

    Scenario: 通常アイテムについて，販売期限を過ぎて品質が0の場合、次の日になっても品質は0のままである
      Given 品質が0の通常アイテムが存在する
      And そのアイテムは販売期限を1日過ぎている
      When 1日経過する
      Then そのアイテムの品質は0である
      And そのアイテムは販売期限を1日過ぎている

    Scenario: 通常アイテムについて，販売期限を過ぎて品質が1の場合、次の日に-1にはならず0になる
      Given 品質が1の通常アイテムが存在する
      And そのアイテムは販売期限当日である（期限切れ劣化が適用される）
      When 1日経過する
      Then そのアイテムの品質は0である
      And そのアイテムは販売期限を1日過ぎている
