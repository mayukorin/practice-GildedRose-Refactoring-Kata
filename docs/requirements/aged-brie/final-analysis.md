# Aged Brie 確定仕様

このドキュメントは、Aged Brieアイテムタイプの確定仕様を簡潔にまとめたものです。
詳細な分析プロセスは `analysis.md` を参照してください。

## 確定した仕様ルール

### R1: 販売期限内のQuality増加
- **条件**: sellIn > 0 かつ quality < 50
- **処理**: quality を +1
- **頻度**: 毎日

### R2: 販売期限切れ後のQuality増加（2倍速）
- **条件**: sellIn ≤ 0 かつ quality < 50
- **処理**: quality を +2（基本の+1に加えて追加の+1）
- **頻度**: 毎日
- **備考**: 通常アイテムの「期限切れで2倍速劣化」と対称的な振る舞い

### R3: SellInの減少
- **条件**: 常に（Aged Brieも対象）
- **処理**: sellIn を -1
- **頻度**: 毎日

### R4: Qualityの上限
- **制約**: quality は50を超えない
- **実装**: 各増加処理の前に `quality < 50` をチェック
- **結果**: quality = 50 で増加が停止

### R5: Qualityの下限（理論上）
- **制約**: quality は0未満にならない
- **備考**: Aged BrieはQualityが増加するため、実質的に適用場面なし

## 重要な決定事項

### 販売期限切れ後の2倍速増加について

**決定**: コードの実装を正式仕様として採用

**理由**:
1. 通常アイテムとの対称性が保たれる
   - 通常アイテム: 期限切れで劣化速度2倍
   - Aged Brie: 期限切れで向上速度2倍
2. コードの実装が明確な意図を持っている
3. ビジネスロジックとして矛盾しない（熟成が進むほど価値が上がる）
4. 要件文は簡略化された記述と解釈できる

### sellIn = 0（販売期限当日）の扱い

**決定**: 期限切れ扱い（+2増加）

**理由**:
- コードでは sellIn を -1 してから期限切れ判定（sellIn < 0）を行う
- sellIn = 0 の場合も、-1 後に sellIn = -1 となり期限切れ処理が適用される
- 通常アイテムと同じ解釈で一貫性がある

## 境界条件の確定

| 初期状態 | sellIn | quality | 1日後 sellIn | 1日後 quality | 説明 |
|---------|--------|---------|-------------|--------------|------|
| 期限内 | 3 | 10 | 2 | 11 | +1増加（通常速度） |
| 期限内（上限直前） | 3 | 49 | 2 | 50 | +1で上限到達 |
| 期限内（上限） | 3 | 50 | 2 | 50 | 増加しない |
| 期限当日 | 0 | 10 | -1 | 12 | +2増加（期限切れ扱い） |
| 期限切れ | -1 | 10 | -2 | 12 | +2増加（2倍速） |
| 期限切れ（上限直前） | -1 | 49 | -2 | 50 | +1のみ（上限で停止） |
| 期限切れ（上限） | -1 | 50 | -2 | 50 | 増加しない |

## 処理フロー

```
毎日の処理:
  1. Quality増加（フェーズ1）
     IF quality < 50 THEN
       quality = quality + 1
     END IF

  2. SellIn減少（フェーズ2）
     sellIn = sellIn - 1

  3. 期限切れ後の追加Quality増加（フェーズ3）
     IF sellIn < 0 AND quality < 50 THEN
       quality = quality + 1
     END IF
```

## 次フェーズへの引き継ぎ事項

### フェーズ2（振る舞いの形式化）に向けて

以下のテストパターンを網羅すること：

1. **基本パターン**:
   - 期限内での+1増加
   - 期限切れでの+2増加

2. **境界値パターン**:
   - sellIn = 1 → 0（期限内から当日への遷移）
   - sellIn = 0 → -1（当日から期限切れへの遷移）
   - quality = 49 → 50（上限到達）
   - quality = 50 → 50（上限での維持）

3. **エッジケース**:
   - 期限切れで quality = 49 の場合（+1のみ、+2にならない）
   - 初期状態が quality = 50 の場合
   - 負のsellInでの連続処理

### 状態遷移図で表現すべき状態

- **期限内状態**（sellIn > 0）
- **期限当日状態**（sellIn = 0）
- **期限切れ状態**（sellIn < 0）
- **上限到達状態**（quality = 50）

### 注意点

- Quality上限チェックは、各増加処理の前に実行される
- sellInの減少はQuality増加の途中で実行される（フェーズ2）
- 期限切れ判定（sellIn < 0）は、sellIn減少後に評価される

## 参照

- 詳細な分析プロセス: `analysis.md`
- 元の要件文: `GildedRoseRequirements_jp.md`
- 実装コード: `Java/src/main/java/com/gildedrose/GildedRose.java:10-61`
- 通常アイテムの仕様: `docs/requirements/normal-item/final-analysis.md`
