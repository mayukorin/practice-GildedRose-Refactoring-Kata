# Sulfuras - 要件分析

## 1. 要件抽出

GildedRoseRequirements_jp.mdから、Sulfurasに関する要件を抽出します。

### 基本要件

**出典**: GildedRoseRequirements_jp.md:22
> "Sulfuras"は伝説のアイテムなので、販売されたり、Quality値が低下したりすることはありません。

**出典**: GildedRoseRequirements_jp.md:33
> ただし、"Sulfuras "は伝説のアイテムであるため、Quality値は80であり、Quality値が変わることはありません。

### 要件の解釈

Sulfurasは他のアイテムとは根本的に異なる特性を持つ：

1. **品質の不変性**: Quality値は常に80で固定
   - 日が経過しても品質は変化しない
   - 劣化も向上もしない

2. **販売期限の扱い**:
   - 「販売されたり」しない → 販売期限（sellIn）の概念が適用されない可能性
   - 解釈の余地あり:
     - (A) sellInが減らない（固定値のまま）
     - (B) sellInは減るが品質には影響しない
     - (C) sellInそのものが存在しない（または意味を持たない）

3. **伝説のアイテムとしての特別扱い**:
   - 通常のアイテム更新ロジックを適用してはいけない
   - 特別な処理（または処理しない）が必要

### 不明点・確認事項

1. **sellInの振る舞い**:
   - sellInは減るのか？
   - 既存コードではどう実装されているか？

2. **初期値の制約**:
   - 必ず品質80で作成されるのか？
   - それとも、品質80以外で作成されても80に修正されるのか？

3. **名前の判定**:
   - 完全一致で"Sulfuras, Hand of Ragnaros"なのか？
   - 前方一致で"Sulfuras"を含むものすべてか？

## 2. コード分析

既存のGildedRose.java:10のupdateQualityメソッドから、Sulfurasに関する処理を抽出します。

### Sulfurasの判定方法

**コード箇所**: GildedRose.java:15, 39, 47

名前の判定は完全一致：
```java
items[i].name.equals("Sulfuras, Hand of Ragnaros")
```

### 品質（quality）の処理

**コード箇所1**: GildedRose.java:15-17（販売期限内の通常劣化処理）
```java
if (!items[i].name.equals("Sulfuras, Hand of Ragnaros")) {
    items[i].quality = items[i].quality - 1;
}
```
→ Sulfurasの場合、品質を減らさない（処理をスキップ）

**コード箇所2**: GildedRose.java:47-49（販売期限切れ後の追加劣化処理）
```java
if (!items[i].name.equals("Sulfuras, Hand of Ragnaros")) {
    items[i].quality = items[i].quality - 1;
}
```
→ Sulfurasの場合、品質を減らさない（処理をスキップ）

**結論**: Sulfurasの品質は変化しない

### 販売期限（sellIn）の処理

**コード箇所**: GildedRose.java:39-41
```java
if (!items[i].name.equals("Sulfuras, Hand of Ragnaros")) {
    items[i].sellIn = items[i].sellIn - 1;
}
```
→ Sulfurasの場合、sellInを減らさない（処理をスキップ）

**結論**: SulfurasのsellInは変化しない

### コードから読み取れる振る舞い

1. **品質の不変性**: qualityは一切変化しない
   - 販売期限内でも減らない
   - 販売期限切れでも減らない

2. **販売期限の不変性**: sellInも一切変化しない
   - 「販売されない」という要件と一致

3. **名前の判定**: 完全一致で"Sulfuras, Hand of Ragnaros"
   - 前方一致ではない

### 未確認の振る舞い

1. **初期品質値**: コードでは品質80に固定する処理がない
   - 要件では「Quality値は80である」と記載
   - しかし、コードでは品質を変更しないだけで、80に設定する処理はない
   - 初期値が80以外だった場合の動作が不明確

2. **品質の範囲チェック**: Sulfurasに対して0〜50の制約は適用されるか？
   - 要件では「Quality値は80である」と明記（50を超える例外）
   - コードでは品質を変更しないため、初期値がそのまま保持される

## 3. 差分分析

要件とコードの振る舞いを比較し、差分を確認します。

### 一致している点

| 項目 | 要件 | コード実装 | 判定 |
|------|------|------------|------|
| 品質の変化 | 「Quality値が変わることはありません」 | qualityを変更する処理がない | ✓ 一致 |
| 販売期限の扱い | 「販売されたり」しない | sellInを減らさない | ✓ 一致 |
| 名前 | "Sulfuras" | "Sulfuras, Hand of Ragnaros"（完全一致） | ✓ 一致 |

### 差分・不明確な点

#### 1. 初期品質値の扱い

**要件**: 「Quality値は80である」

**コード**: 品質を変更しない実装のみ。80に設定する処理はない。

**問題点**:
- 要件は「品質は80である」と断定的に記述
- コードでは品質を変更しないだけで、80であることを保証していない
- Itemクラスは変更禁止なので、コンストラクタでの検証もできない

**解釈の選択肢**:
- (A) **前提条件として扱う**: Sulfurasは必ず品質80で作成されることが前提
  - テストでは品質80のSulfurasのみを扱う
  - 品質80以外で作成された場合の動作は未定義（テスト対象外）

- (B) **不変条件として扱う**: updateQualityで品質80に修正する
  - 品質80以外で作成されても、updateQuality実行後は必ず80になる
  - これは「品質が変わることはない」という要件と矛盾する可能性

**推奨**: (A) 前提条件として扱う
- 要件は「販売されたり、Quality値が低下したりすることはありません」と記載
- これは「変化しない」ことを意味し、「80に修正する」ことを意味しない
- コードの振る舞いとも一致

#### 2. sellInの初期値

**要件**: sellInについての明示的な記述なし（「販売されない」のみ）

**コード**: sellInを減らさない

**問題点**:
- sellInの初期値に制約があるか不明
- 販売期限の概念自体が無意味なのか、単に減らないだけなのか

**解釈**: sellInの値は任意。減らないだけで、初期値に制約はない。

#### 3. 品質の上限（50）の適用

**要件**:
- 共通ルール「Quality値は50以上にはなりません」
- Sulfuras固有「Quality値は80である」

**問題点**: Sulfurasは品質50の上限の例外なのか？

**解釈**: Sulfurasは例外
- 要件で明確に「Quality値は80である」と記載
- 共通ルールの例外として扱う

### 確定すべき仕様

以下の点について、テスト仕様を作成する前に確定が必要：

1. **初期品質値**: 品質80のみをテスト対象とする（前提条件）
2. **品質の上限**: Sulfurasは50の上限の例外（品質80を許容）
3. **sellInの扱い**: 初期値は任意、減らないことのみ確認
