# スペック駆動開発ワークフロー（初期案）

## 概要

Gilded Roseプロジェクトにおけるスペック駆動開発とClaude活用の統合ワークフローの検討ドキュメント。

## スペック駆動開発とは

従来のテスト駆動開発（TDD）を拡張し、以下の要素を重視：

1. **形式的な仕様定義** - 自然言語の要件を構造化された仕様に変換
2. **仕様からのテスト導出** - 仕様を網羅するテストケースを体系的に生成
3. **実行可能な仕様** - テスト自体が仕様のドキュメントとして機能
4. **継続的な仕様の検証** - コードが常に仕様と一致することを保証

## Gilded Roseでの適用シナリオ

### シナリオ1: レガシーコードのキャラクタライゼーション

**目的**: 既存のupdateQualityメソッドの振る舞いを仕様として抽出

**ステップ**:
1. 要件仕様（GildedRoseRequirements.md）を分析
2. 各アイテムタイプごとに振る舞いを形式化
3. 境界値と特殊ケースを列挙
4. 網羅的なテストケースを生成
5. ゴールデンマスターテストで現行動作を固定

### シナリオ2: 新機能の追加（Conjured items）

**目的**: 仕様駆動で新機能を追加

**ステップ**:
1. Conjured itemsの仕様を明確に定義
2. 仕様から受入テストを導出
3. テストファーストで実装
4. 既存機能への影響を検証

### シナリオ3: リファクタリング

**目的**: 振る舞いを保ちながらコード品質を改善

**ステップ**:
1. 仕様ベースのテストで安全網を構築
2. 小さなステップでリファクタリング
3. 各ステップで仕様の整合性を確認

## Claudeを活用した開発フロー（案）

### フェーズ1: 仕様の形式化

**人間の役割**:
- プロジェクトのコンテキストを提供
- 仕様の優先順位を決定
- あいまいな要件を明確化

**Claudeの役割**:
- GildedRoseRequirements.mdの分析
- 構造化された仕様ドキュメントの生成
- 仕様の網羅性チェック
- エッジケースの洗い出し

**成果物**:
- アイテムタイプごとの振る舞い仕様
- 状態遷移表
- 境界値リスト

### フェーズ2: テスト戦略の策定

**人間の役割**:
- テストフレームワークの選択
- テストの粒度を決定
- テストの優先順位付け

**Claudeの役割**:
- 仕様からテストケースを導出
- テストコードのテンプレート生成
- カバレッジ分析
- パラメタライズドテストの提案

**成果物**:
- テスト計画書
- テストケースマトリクス
- テストコードの雛形

### フェーズ3: テストの実装

**人間の役割**:
- テストコードのレビュー
- テストの実行と結果確認
- テストの調整

**Claudeの役割**:
- テストコードの完全な実装
- アサーションの生成
- テストヘルパーの作成
- モックデータの準備

**成果物**:
- 実行可能なテストスイート
- カバレッジレポート

### フェーズ4: 実装・リファクタリング

**人間の役割**:
- リファクタリング方針の決定
- 設計パターンの選択
- コードレビュー

**Claudeの役割**:
- リファクタリング案の提示
- 段階的な実装サポート
- コード品質の分析
- 潜在的な問題の指摘

**成果物**:
- リファクタリングされたコード
- 改善点のドキュメント

### フェーズ5: ドキュメンテーション

**人間の役割**:
- ドキュメントの最終確認
- チームへの共有

**Claudeの役割**:
- 実装の説明文書生成
- 仕様書の更新
- ADR（Architecture Decision Records）の作成

**成果物**:
- 更新された仕様書
- 設計ドキュメント
- 意思決定記録

## 具体的なワークフロー例

### 例1: "Aged Brie"の仕様化とテスト

```
1. Claude: 要件から"Aged Brie"の振る舞いを抽出
   - sellIn値が減少する（Sulfuras以外の共通動作）
   - quality値が増加する（通常アイテムと逆）
   - quality上限は50
   - sellIn < 0の場合、quality増加速度が2倍

2. Claude: テストケースを導出
   - sellIn > 0, quality < 50 → quality +1, sellIn -1
   - sellIn > 0, quality = 50 → quality 変化なし, sellIn -1
   - sellIn = 0, quality < 49 → quality +2, sellIn -1
   - sellIn < 0, quality = 50 → quality 変化なし
   など

3. 人間: テストケースをレビューし承認

4. Claude: JUnitテストコードを生成

5. 人間: テストを実行し、現行コードの振る舞いを確認

6. 必要に応じてリファクタリング
```

## 検討事項・質問

### 技術的な検討点
- [ ] どのテストフレームワークを使うか？（JUnit 5でパラメタライズドテスト？）
- [ ] 承認テスト（Approval Tests）との使い分けは？
- [ ] Property-based testingは適用できるか？
- [ ] テストデータの管理方法は？

### プロセス上の検討点
- [ ] 仕様とテストの同期をどう保つか？
- [ ] リファクタリング中のテストメンテナンスは？
- [ ] 段階的な移行戦略は？
- [ ] レビューポイントはどこに設けるか？

### Claudeとの協働について
- [ ] どこまでClaude に任せるか？
- [ ] 人間が判断すべき部分は？
- [ ] フィードバックループの設計は？
- [ ] 生成されたコードの品質保証は？

## 次のアクション

1. このワークフローについて壁打ち・議論
2. 具体的な部分を詳細化
3. 小規模な試行で検証
4. フィードバックを元に改善

---

**ステータス**: 初期案・議論中
**作成日**: 2025-12-29
**更新日**: 2025-12-29
