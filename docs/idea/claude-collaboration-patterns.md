# Claude協働パターン集（案）

## このドキュメントについて

スペック駆動開発におけるClaude Codeとの効果的な協働パターンを整理するドキュメント。

## 協働パターンの分類

### 1. 仕様分析パターン

#### パターン1-1: 要件の構造化
**状況**: 自然言語で書かれた要件仕様がある

**人間の入力例**:
```
「GildedRoseRequirements.mdを読んで、各アイテムタイプごとの
振る舞いを構造化したドキュメントを作成してください」
```

**Claudeの出力**:
- アイテムタイプの分類表
- 各タイプの振る舞いルール
- 条件と結果のマトリクス
- 特殊ケースの列挙

**利点**:
- 仕様の見落としを防ぐ
- 体系的な理解が得られる
- テスト設計の基礎資料になる

#### パターン1-2: エッジケースの発見
**状況**: 基本仕様は理解したが、境界値や特殊ケースを洗い出したい

**人間の入力例**:
```
「Aged Brieの仕様について、考慮すべきエッジケースを
すべてリストアップしてください」
```

**Claudeの出力**:
- quality = 0, 49, 50の各ケース
- sellIn = 0, -1の境界
- 組み合わせケース
- 仕様書に明示されていない暗黙の制約

### 2. テスト設計パターン

#### パターン2-1: テストケースの網羅的生成
**状況**: 仕様からテストケースを漏れなく導出したい

**人間の入力例**:
```
「"Backstage passes"の仕様から、境界値分析と
同値分割を使ってテストケースを生成してください」
```

**Claudeの出力**:
- 同値クラスの分類
- 境界値のリスト
- テストケース表（入力・期待出力）
- カバレッジマトリクス

#### パターン2-2: パラメタライズドテストの設計
**状況**: 同じロジックを複数の入力で検証したい

**人間の入力例**:
```
「先ほどのテストケースをJUnit 5の@ParameterizedTestで
実装してください」
```

**Claudeの出力**:
- @CsvSourceまたは@MethodSource を使ったテストコード
- テストデータの整理
- わかりやすいテスト名の生成

#### パターン2-3: Given-When-Thenの構造化
**状況**: BDD形式でテストを書きたい

**人間の入力例**:
```
「このテストケースをGiven-When-Then形式で
わかりやすく書き直してください」
```

**Claudeの出力**:
- 明確な3段階構造
- コメントまたはメソッド名での意図表明
- 可読性の高いアサーション

### 3. リファクタリングパターン

#### パターン3-1: リファクタリング計画の立案
**状況**: 複雑なコードをどうリファクタリングすべきか検討したい

**人間の入力例**:
```
「GildedRose.javaのupdateQualityメソッドを
リファクタリングする計画を立ててください。
小さなステップで段階的に進められるようにしてください」
```

**Claudeの出力**:
- ステップバイステップの計画
- 各ステップのリスク評価
- テストの追加が必要な箇所
- 優先順位付け

#### パターン3-2: パターン適用の提案
**状況**: 設計パターンの適用を検討したい

**人間の入力例**:
```
「現在のコードに適用できる設計パターンを提案してください。
それぞれのメリット・デメリットも教えてください」
```

**Claudeの出力**:
- Strategy パターン
- Visitor パターン
- 各パターンの実装イメージ
- トレードオフの説明

#### パターン3-3: 段階的な実装支援
**状況**: リファクタリングを一歩ずつ進めたい

**人間の入力例**:
```
「まず最初のステップとして、マジックナンバーを
定数に抽出してください」
```

**Claudeの出力**:
- 具体的なコード変更
- 変更箇所の説明
- 次のステップの提案

### 4. レビューパターン

#### パターン4-1: コードレビュー
**状況**: 自分で書いたコードをレビューしてほしい

**人間の入力例**:
```
「このテストコードをレビューして、改善点を指摘してください」
```

**Claudeの出力**:
- コードの問題点
- ベストプラクティスからの逸脱
- 改善提案
- セキュリティやパフォーマンスの観点

#### パターン4-2: 仕様との整合性チェック
**状況**: 実装が仕様を満たしているか確認したい

**人間の入力例**:
```
「このコードがGildedRoseRequirements.mdの
すべての要件を満たしているか検証してください」
```

**Claudeの出力**:
- 要件ごとのチェックリスト
- 未実装の要件
- 仕様との不一致
- 追加テストの提案

### 5. ドキュメンテーションパターン

#### パターン5-1: 設計判断の記録
**状況**: なぜその設計を選んだか記録したい

**人間の入力例**:
```
「Strategy パターンを採用した理由をADR形式で
ドキュメント化してください」
```

**Claudeの出力**:
- ADR（Architecture Decision Record）
- 検討した代替案
- 決定の理由
- 影響範囲

#### パターン5-2: 実装ガイドの生成
**状況**: 他の人が理解できるドキュメントが必要

**人間の入力例**:
```
「リファクタリング後のコードについて、
設計の意図を説明するドキュメントを作成してください」
```

**Claudeの出力**:
- アーキテクチャ概要
- クラス図・シーケンス図
- 主要な設計判断
- 拡張ポイント

## 効果的な協働のためのベストプラクティス

### プロンプトの書き方

**明確な指示**:
```
❌ 「テストを書いて」
✅ 「Aged Brieの品質増加ロジックについて、
    sellInが正・0・負の各ケースでqualityが
    正しく増加することを検証するテストを
    JUnit 5で書いてください」
```

**コンテキストの提供**:
```
✅ 「GildedRose.javaとGildedRoseRequirements.mdを
    読んだ上で、...」
```

**段階的な指示**:
```
✅ 「まず仕様を分析してください。その後、
    テストケースを提案してください。
    承認したら実装をお願いします」
```

### フィードバックの与え方

**具体的なフィードバック**:
```
❌ 「ちょっと違います」
✅ 「quality上限は50ですが、Sulfurasは例外で80です。
    この点を考慮してテストを修正してください」
```

**承認と次のステップ**:
```
✅ 「このテストケースは良いですね。
    では次に、これをパラメタライズドテストとして
    実装してください」
```

### 検証ポイント

**Claudeの出力を盲信しない**:
- [ ] 生成されたテストを実行して確認
- [ ] 仕様との整合性を自分で確認
- [ ] エッジケースの漏れがないかチェック
- [ ] コードの可読性を評価

**段階的な進行**:
- [ ] 小さな単位で確認
- [ ] 一度に大きな変更をしない
- [ ] 各ステップでテストを実行

## アンチパターン（避けるべきこと）

### ❌ 丸投げパターン
```
「Gilded Roseを完全にリファクタリングしてください」
```
**問題**: 大きすぎる、意図が不明確、検証が困難

### ❌ 曖昧な指示パターン
```
「良い感じにして」
```
**問題**: 「良い」の定義が不明確

### ❌ コンテキスト不足パターン
```
「このメソッドをリファクタリングして」
（どのファイルのどのメソッドか不明）
```
**問題**: Claudeが推測に頼ることになる

### ❌ 検証なしパターン
```
Claudeのコード生成 → そのままコミット
```
**問題**: バグや仕様違反の可能性

## 次のアクション

- [ ] 実際のワークフローで各パターンを試す
- [ ] 効果的だったパターンを記録
- [ ] プロジェクト固有のパターンを追加
- [ ] チーム内でパターンを共有

---

**ステータス**: 初期案・議論中
**作成日**: 2025-12-29
**更新日**: 2025-12-29
